# $Id$
#
#   UNIX-Connect, a ZCONNECT(r) Transport and Gateway/Relay.
#   Copyright (C) 1993-94  Martin Husemann
#   Copyright (C) 1995-98  Christopher Creutzig
#   Copyright (C) 1999     Dirk Meyer
#
#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 2 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
#
#  ------------------------------------------------------------------------
#  Eine deutsche Zusammenfassung zum Copyright dieser Programme sowie der
#  GNU General Public License finden Sie in der Datei README.1st.
#  ------------------------------------------------------------------------
#
#   Bugreports, suggestions for improvement, patches, ports to other systems
#   etc. are welcome. Contact the maintainer by e-mail:
#   dirk.meyer@dinoex.sub.org or snail-mail:
#   Dirk Meyer, Im Grund 4, 34317 Habichstwald
#
#   There is a mailing-list for user-support:
#    unix-connect@mailinglisten.im-netz.de,
#   write a mail with subject "Help" to
#    nora.e@mailinglisten.im-netz.de
#   for instructions on how to join this list.
#

include .makefile.conf

all:
	(cd lib; $(MAKE) strlib.a)
	(cd hdlib; $(MAKE) all)
	shell/update hdlib/hd_nam.h include/hd_nam.h
	shell/update hdlib/hd_def.h include/hd_def.h
	(cd lib; $(MAKE) all)
	(cd date; $(MAKE) all)
	(cd online; $(MAKE) all)
	(cd gate; $(MAKE) all)
	(cd tools; $(MAKE) all)
	(cd rsmtp; $(MAKE) all)

install: install-dirs install-usr-lib-zcon
	(cd online; $(MAKE) install)
	(cd gate; $(MAKE) install)
	(cd tools; $(MAKE) install)
	(cd shell; $(MAKE) install)
	(cd rsmtp; $(MAKE) install)

clean:
	-rm -f $(CLEANFILES)
	(cd lib; $(MAKE) clean)
	(cd date; $(MAKE) clean)
	(cd hdlib; $(MAKE) clean)
	(cd online; $(MAKE) clean)
	(cd gate; $(MAKE) clean)
	(cd tools; $(MAKE) clean)
	(cd rsmtp; $(MAKE) clean)

clobber:
	-rm -f include/hd_nam.h
	-rm -f include/hd_def.h
	(cd lib; $(MAKE) clobber)
	(cd date; $(MAKE) clobber)
	(cd hdlib; $(MAKE) clobber)
	(cd online; $(MAKE) clobber)
	(cd gate; $(MAKE) clobber)
	(cd tools; $(MAKE) clobber)
	(cd rsmtp; $(MAKE) clobber)

tidy:	clobber
	-rm -f lib/Makefile
	-rm -f date/Makefile
	-rm -f hdlib/Makefile
	-rm -f online/Makefile
	-rm -f gate/Makefile
	-rm -f tools/Makefile
	-rm -f shell/Makefile
	-rm -f Makefile
	-rm -f .makefile.conf
	-rm -f config.cache config.log config.status
	-rm -f include/sysdep.h include/policy.h include/config.h
	-rm -f misc/config

distrib:	tidy
	(cd hdlib; $(MAKE) -f Makefile.in tidy)
	(cd hdlib; $(MAKE) -f Makefile.in SHELL=/bin/sh hash.c)
	-rm -f configure.dat
	-rm -f docs/unix-connect.{aux,log,toc,cp,fn,ky,pg,tp,vr}

install-dirs:
	if test ! -d $(DESTDIR); then mkdir $(DESTDIR); chown $(USER) $(DESTDIR); fi
	if test ! -d $(DESTDIR)/systems; then mkdir $(DESTDIR)/systems; chown $(USER) $(DESTDIR)/systems; fi

install-usr-lib-zcon:
	install -o @USER@ -g @GROUP@ -m 660 usr-l-lib-zcon/* -b -S .old $(DESTDIR)/
